<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>顧客データ記録</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background-color: #f9f9f9;
    }
    button {
      width: 120px;
      height: 50px;
      margin: 10px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .male { background-color: blue; color: white; }
    .female { background-color: pink; color: white; }
    .other { background-color: purple; color: white; }
    .tourist { background-color: green; color: white; }
  </style>
</head>
<body>
  <h1>顧客データ記録</h1>
  <div>
    <button class="male" onclick="selectGender('男性')">男性</button>
    <button class="female" onclick="selectGender('女性')">女性</button>
    <button class="other" onclick="selectGender('その他')">その他</button>
  </div>
  <div>
    <button class="age" data-age="10代" onclick="saveGenderAndAge('10代')">10代</button>
    <button class="age" data-age="20代" onclick="saveGenderAndAge('20代')">20代</button>
    <button class="age" data-age="30代" onclick="saveGenderAndAge('30代')">30代</button>
    <button class="age" data-age="40代" onclick="saveGenderAndAge('40代')">40代</button>
    <button class="age" data-age="50代" onclick="saveGenderAndAge('50代')">50代</button>
    <button class="age" data-age="60代~" onclick="saveGenderAndAge('60代~')">60代~</button>
  </div>
  <button onclick="sendDataToFirebase()">データ送信</button>
  <button onclick="clearLocalStorage()">ローカルストレージ削除</button>

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script>
    // Firebaseの設定
    const firebaseConfig = {
        apiKey: "AIzaSyAzDStUOQsPssdqSIQed6z8snsHL8r5q3o",
        authDomain: "ichiedata-2075b.firebaseapp.com",
        databaseURL: "https://ichiedata-2075b-default-rtdb.firebaseio.com",
        projectId: "ichiedata-2075b",
        storageBucket: "ichiedata-2075b.firebasestorage.app",
        messagingSenderId: "378556332609",
        appId: "1:378556332609:web:e58a5579cff83664d2e4c0",
        measurementId: "G-ZXTMWCMH1G"
    };

    // Firebaseの初期化
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    let customerData = [];
    let selectedGender = null; // 一時的に性別を保存

    // 性別を選択
    function selectGender(gender) {
      selectedGender = gender;
      alert(`${gender} を選択しました。年齢を選択してください`);
    }

    // 性別と年齢を保存
    function saveGenderAndAge(age) {
      if (!selectedGender) {
        alert("先に性別を選択してください！");
        return;
      }

      const timestamp = new Date().toISOString();
      const genderAndAge = `${selectedGender}-${age}`;
      customerData.push({ genderAndAge, timestamp });
      localStorage.setItem("customerData", JSON.stringify(customerData));
      alert(`${genderAndAge} を保存完了！！！`);

      // 選択をリセット
      selectedGender = null;
    }

    // データ送信関数
    function sendDataToFirebase() {
      const storedData = localStorage.getItem("customerData");
      if (!storedData) {
        alert("送信するデータがありません。");
        return;
      }

      const data = JSON.parse(storedData);
      const timestamp = new Date().toISOString();

      // 使用できない文字を置き換え
      const sanitizedTimestamp = timestamp.replace(/\./g, "_").replace(/:/g, "-");

      console.log("送信するデータ: ", data); // デバッグ用ログ

      const dbRef = database.ref("customerData/" + sanitizedTimestamp);
      dbRef.set(data)
        .then(() => {
          alert("データを送信しました！");
          localStorage.clear();
          customerData = [];
        })
        .catch((error) => {
          console.error("送信エラー: ", error);
          alert("送信に失敗しました: " + error.message);
        });
    }

    // ローカルストレージ削除関数
    function clearLocalStorage() {
      localStorage.clear();
      customerData = [];
      alert("ローカルストレージを削除");
    }
  </script>
</body>
</html>
